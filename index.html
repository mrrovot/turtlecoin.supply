<!DOCTYPE html>
<html lang="en">

<head>
    <script
              src="https://code.jquery.com/jquery-3.3.1.min.js"
              integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
              crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TurtleCoin Supply</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
</head>

<body>
    <div class="container">
        <nav class="navbar is-transparent">
            <div class="navbar-brand">
                <a class="navbar-item" href="/">
      <img src="/img/turtlecoin_wordmark_color@HD.png" alt="TurtleCoin Supply info" width="112" height="40">
    </a>
                <div class="navbar-burger burger" data-target="navbarExampleTransparentExample">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <div id="navbarExampleTransparentExample" class="navbar-menu">
                <!--        <div class="navbar-start">
                    <a class="navbar-item" href="https://turtlecoin.lol/" target="_blank">
        About TRTL
      </a>
     
                </div> -->
                <div class="navbar-end">
                    <div class="navbar-item">
                        <div class="field is-grouped">
                            <p class="control">
                                <a class="button is-primary" href="https://turtlecoin.lol" target="_blank">

              <span>About TurtleCoin</span>
            </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        <section id="mainmsg">
            <article class="message is-primary">
                <div class="message-header">
                    <p>TurtleCoin.supply</p>
                </div>
                <div class="message-body">
                    <div class="columns" style="horizontal">
                        <div class="column">
                            Current supply: <strong id="supply"></strong>
                        </div>
                        <div class="column">
                            Current price: <strong id="currentPrice"></strong>
                        </div>
                        <div class="column">
                            Market Cap: <strong id="marketCap"></strong>
                        </div>
                    </div>
                </div>
            </article>
        </section>
        <div id="chartContainer" style="height: 600px; width: 100%;"></div>
    </div>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script>
    const numberWithCommas = (x) => {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }


    function getDates() {
        return axios.get('/dates.json');
    }

    function getSupply() {
        return axios.get('/supply.json');
    }

    function getCurrentSupply() {
        return axios.get('https://trtl-explorer.xhub.cloud/q/supply/')
    }

    function getTurtleCoinPrice() {
        return axios.get('https://tradeogre.com/api/v1/ticker/BTC-TRTL')
    }

    function getCurrentBitcoinPrice() {
        return axios.get('https://api.coindesk.com/v1/bpi/currentprice.json')
    }

    axios.all([getCurrentSupply(), getTurtleCoinPrice(), getCurrentBitcoinPrice(), getDates(), getSupply()])
        .then(axios.spread(function(currentSupply, turtleCoinPrice, bitcoinPrice, dates, supply, ) {
            btc_price = bitcoinPrice.data.bpi.USD.rate_float;
            trtl_price = turtleCoinPrice.data.price;
            usdTrtlPrice = (btc_price * trtl_price).toFixed(8);
            document.querySelector("#supply").innerText = numberWithCommas(currentSupply.data);
            document.querySelector("#currentPrice").innerText = `$${usdTrtlPrice}`;
            document.querySelector("#marketCap").innerText = `$${numberWithCommas((usdTrtlPrice*currentSupply.data).toFixed(0))}`;
            var data = []; var dataSeries = { type: "line", color: "#3cba9f" };
            var dataPoints = [];
            for (var i = 0; i <= dates.data.dates.length; i++) {
             y = supply.data.supply[i];
             dateTime = new Date(dates.data.dates[i]);
             dataPoints.push({
                 x: dateTime,
                 y: y,
                 lineColor: "#3cba9f",
                 color: "#3cba9f"
               });
            }
            dataSeries.showInLegend = true;
            dataSeries.legendText = "Projected Supply";
            dataSeries.dataPoints = dataPoints;

            data.push(dataSeries);

            var currentPoint = { type: "line", lineThickness: 10, color: "#16463c" };
            currentPoint.showInLegend = true;
            currentPoint.legendText = "Current Supply";
            currentPoint.dataPoints = [{ x: new Date(), y: currentSupply.data / 1000000000, lineColor: "#16463c",  color: "#16463c"}];

            data.push(currentPoint);

            today = new Date();
            var chart = new CanvasJS.Chart("chartContainer",
            {
              legend: {
                horizontalAlign: "left", // "center" , "right"
                verticalAlign: "center",  // "top" , "bottom"
                fontSize: 15
              },
              zoomEnabled: true,      
              title:{
                text: "TurtleCoin Supply Over Time in Billions" 
              },
              axisY :{
                labelFontSize: 18,
              },
              axisX:{
                labelAngle: -30,
                labelFontSize: 15,
                viewportMinimum: new Date(today.getFullYear()-1, today.getMonth(), today.getDate()),
                viewportMaximum: new Date(today.getFullYear()+1, today.getMonth(), today.getDate())
              },
              data: data 

            });
            chart.render();
            var limit = 100000;   
    
            var y = 0;
            var style = "display: inline; background-color: white; color: black; border-color: currentcolor rgb(33, 150, 243) currentcolor currentcolor; border-style: none solid none none; border-width: medium 1px medium medium; border-image: none 100% / 1 / 0 stretch; -moz-user-select: none; padding: 5px 12px; cursor: pointer; float: right; width: 120px; height: 25px; outline: 0px none currentcolor; vertical-align: baseline; line-height: 0; transition: all 0.4s ease 0s;";
            var zoomoutbutton = $('<button ' + 'style=\"'+style+'\">Zoom Out</button>').click(function () {
                    chart.options.axisX.viewportMinimum = new Date("2017-12-01");
                    chart.options.axisX.viewportMaximum = new Date("2112-12-31");
                    chart.render();
                });
            var buttonbar = $(".canvasjs-chart-toolbar").append(zoomoutbutton)
        }));
    </script>
</body>

</html>
<style>
#mainmsg {
    margin-top: 3em;
}

.columns {
        display: flex;
    align-items: center;
    justify-content: center;
}
.column {
    text-align: center;
}
</style>